<!DOCTYPE html>
<html>
  <head>
    <title>酒店搜索</title>
    <meta charset=utf-8>        
	<link href="/css/bootstrap.css" rel="stylesheet" type="text/css" />
    <link href="/css/style_nomal.css" rel="stylesheet" type="text/css" />
    <link href="/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
    <link href="/css/datetimepicker.css" rel="stylesheet" type="text/css" />
<!--what a mess code.-->
    <script src="/js/jquery.js"></script>
    <script type="text/javascript" src="/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/js/bootstrap-datetimepicker.js" charset="UTF-8" ></script>
  </head>
  <body>
  
  
%include template/head_bar.inc
   <div class="container-fluid">
	<div class="row-fluid">
		  <div class="span2">
          <div class="well sidebar-nav">
            <ul class="nav nav-list">
              <li class="nav-header">酒店</li>
              <li class="active"><a href="#" onclick="hide_inn()">酒店预定</a></li>
              <li><a href="#" onclick="show_inn()">旅馆预定</a></li>			
              <li class="nav-header">航班</li>
              <li><a href="/flight/search">国内航班</a></li>
			  <li><a href="/flight/search">国际航班</a></li>
              <li class="nav-header">订单管理</li>
              <li ><a href="/trade/booking_history">订单历史</a></li>
              <li ><a href="/trade/comment_history">评价历史</a></li>
            </ul>
          </div><!--/.well -->
          </div><!--/span-->
<div class="span10">
  <div class="main">
      <div class="well sidebar-nav">
          <ul class="breadcrumb">
              <li><a href="#">预定系统</a><span class="divider">/</span></li>
              <li><a href="#" onclick="hide_inn()">酒店预定</a><span class="divider">/</span></li>
              <li class="active">酒店预定</a></li>
          </ul>
              <div class="row-fluid">
                  <div class="span2 offset1"><label class="radio"><input id="optionsRadios1" type="radio" checked="" value="option1" name="optionsRadios" onclick="hide_inn()">酒店预订</label></div>
                  <div class="span1"></div>
                  <div class="span2"><label class="radio"><input type="radio" name="optionsRadios" id="optionsRadios2" value="option2" onclick="show_inn()">旅馆预订</label></div>
              </div><!--row0-->
          <div id="hotel_order_list">
                  <div class="row-fluid">
                      <div class="span1"> 我想找</div>
                      <div class="span3">
                          <input type="text" style="width: 100%;" placeholder="城市" title="请输入城市" size="20" id="hotel_city" value="" maxlength="30">
                              </div>
                      
                      <div class="span4">
                          <input type="text" style="width: 100%;" placeholder="酒店名、地标、商圈" title="请输入酒店名称" size="30" id="hotel_name" value="%" maxlength="30">
                      </div>
                  </div><!--row1-->
                  <div class="row-fluid">
                      <div class="span1">入住日期</div>
                      <div class="span3">
                          <div class="control-group">
                              <div data-link-field="dtp_in" class="controls input-append date form_datetime1">
                                  <input type="text" style="width: 80%;" value="" readonly>
                                      <span class="add-on"><i class="icon-remove"></i></span>
                                      <span class="add-on"><i class="icon-th"></i></span>
                                      </div>
                              <input type="hidden" value="" id="dtp_in"><br>
                      </div>
                      </div>
                      <div class="span1">离店日期</div>
                      <div class="span3">
                          <div class="control-group">
                              <div data-link-field="dtp_leave" class="controls input-append date form_datetime2">
                                  <input type="text" style="width: 80%;" value="" readonly>
                                      <span class="add-on"><i class="icon-remove"></i></span>
                                      <span class="add-on"><i class="icon-th"></i></span>
                                      </div>
                              <input type="hidden" value="" id="dtp_leave"><br>
                                  </div>
                      </div>
                  </div><!--row2-->
          </div><!--/#hotel_order_list-->
          
          <div class ="row-fluid">
              <div class="span6"></div>
              <a class="btn btn-primary btn-middle" href="#"
                  onclick="fetch_hotel()" >搜  索 »</a>
          </div><!--/*search button-->
      </div>
      <div class="well sidebar-nav" id="display_hotel_panel" style="color:#333333;">
          <div id='display_condition' class="row-fluid" style="display:inline;" >
              <div class="span12">
                  <div class="span6">
                      <div class="span1"></div>
                      <div class="span2">
                          <div class="btn-group">
                              <a class="btn btn-info btn-small dropdown-toggle" data-toggle="dropdown" href="#">
                                  默认排序
                                  <span class="caret"></span>
                              </a>
                              <ul class="dropdown-menu" style="font-size:12px;">
                                  <li value="0" class="choosed"> <a href="#">默认排序</a></li>
                                  <li class="divider"></li>
                                  <li value="1" class=""><a href="#">价格：低到高&nbsp;<i class="icon-arrow-up"></i></a></li>
                                  <li value="2" class=""><a href="#">价格：高到低&nbsp;<i class="icon-arrow-down"></i></a></li>
                                  <li class="divider"></li>
                                  <li value="3" class=""><a href="#">星级：高到低&nbsp;<i class="icon-arrow-down"></i></a></li>
                                  <li value="4" class=""><a href="#">星级：低到高&nbsp;<i class="icon-arrow-up"></i></a></li>
                                  <li class="divider"></li>
                                  <li value="5" class=""><a href="#">评分：高到低&nbsp;<i class="icon-arrow-down"></i></a></li>
                              </ul>
                          </div>
                      </div>
                      
                      <!--div class="span2">
                          <div class="btn-group dropup">
                              <button id="list_condition_star" class="btn btn-info btn-small asc" title="点击按星级从高到低排序" count="0">星级<i class="icon-chevron-up icon-white"></i><i class="icon-chevron-down icon-white"></i></button>
                              </button>
                          </div>
                      </div>
                      <div class="span2">
                          <div class="btn-group dropup">
                              <button id="list_condition_score" class="btn btn-info btn-small desc" title="点击按评分从高到低排序" count="0">评分<i class="icon-chevron-up icon-white"></i><i class="icon-chevron-down icon-white"></i></button>
                              </button>
                          </div>
                      </div>
                      
                      <div class="span2">
                          <div class="btn-group dropup">
                              <button id="list_condition_price" class="btn btn-info btn-small asc" title="点击按价格从低到高排序" count="0">价格<i class="icon-chevron-up icon-white"></i><i class="icon-chevron-down icon-white"></i></button>
                              </button>
                          </div>
                      </div-->
                  </div>
              </div>
          </div><!--/#display_condition-->
          <form id="bookquery" method="get" action="/order"></form>
          <table id='hotel_list' style="background-color:#ffffff;" class="table table-hover">
          </table>
      </div><!--/#display_hotel panel-->
  </div><!--/.main-->
</div><!--/span10-->

  </div><!--/.row-fluid-->
</div><!--/.container-fluid-->
  <footer class="tail">
		<hr>
        <a href="">关于我们</a>
        <a href="">合作伙伴</a>
        <a href="">联系客服</a>
        <a href="../other/connect_us.html">联系我们</a>
        <a href="../other/map.html">网站地图</a>
        <span>© 2013 Black.com 版权所有</span>
   </footer>
       
<script type="text/javascript">
    // " " for selector
    $("#display_hotel_panel").hide()
    $("#dtp_in").val(function(){
                     var dd = new Date();
                     var y = 1900+dd.getYear();
                     var m = dd.getMonth()+1;//获取当前月份的日期
                     if (m<10) m = "0"+m;
                     var d = dd.getDate();
                     if (d<10) d = "0"+d;
                     var h = dd.getHours();
                     if (h<10) h = "0"+h;
                     var mm = dd.getMinutes();
                     if (mm<10) mm = "0"+mm;
                     var s = dd.getSeconds();
                     if (s<10) s = "0"+s;
                     return y+"-"+m+"-"+d+" "+h+":"+mm+":"+s;
                     })
    $("#dtp_leave").val(function(){
                     var dd = new Date();
                     dd.setDate(dd.getDate()+2);//获取AddDayCount天后的日期
                     var y = 1900+dd.getYear();
                     var m = dd.getMonth()+1;//获取当前月份的日期
                     if (m<10) m = "0"+m;
                     var d = dd.getDate();
                     if (d<10) d = "0"+d;
                     var h = dd.getHours();
                     if (h<10) h = "0"+h;
                     var mm = dd.getMinutes();
                     if (mm<10) mm = "0"+mm;
                     var s = dd.getSeconds();
                     if (s<10) s = "0"+s;
                     return y+"-"+m+"-"+d+" "+h+":"+mm+":"+s;
                     })
    $(".radio").click(function(){
        $("#display_hotel_panel").hide()
    })
    function show_inn(){
        $(".nav-list li:eq(2)").addClass('active')
        $(".nav-list li:eq(1)").removeClass('active')
        $(".breadcrumb li:eq(2)").html('旅馆预定')
        $("title").html('旅馆预定')
        $("#optionsRadios2")[0].checked=true
        $("#return").show()
    }
    function hide_inn(){
        $(".nav-list li:eq(2)").removeClass('active')
        $(".nav-list li:eq(1)").addClass('active')
        $(".breadcrumb li:eq(2)").html('酒店预定')
        $("title").html('酒店预订')
        $("#optionsRadios1")[0].checked=true
        $("#return").hide()
    }
    $(".form_datetime1").datetimepicker({
        format: "yyyy/mm/dd",
        todayBtn: 1,
        autoclose: 1,
        minView: 2,
        pickerPosition: "bottom-left"
    });
    $(".form_datetime2").datetimepicker({
        format: "yyyy/mm/dd",
        todayBtn: 1,
        autoclose: 1,
        minView: 2,
        pickerPosition: "bottom-left"
    });
    $("button").click(function(){
        if($(this).attr("count") == "0"){
            $(this).addClass("asc");
            $(this).attr("count","1");
        }else if($(this).attr("count") == "1"){
            $(this).removeClass("asc");
            $(this).addClass("desc");
            $(this).attr("count","2");
        }else if($(this).attr("count") == "2"){
            $(this).removeClass("desc");
            $(this).attr("count","0");
        }
        if($(this).hasClass('asc')){
            $(this).find(".icon-chevron-down").removeClass('icon-white');
            $(this).find(".icon-chevron-up").addClass('icon-white');
        }else if($(this).hasClass('desc')){
            $(this).find(".icon-chevron-up").removeClass('icon-white');
            $(this).find(".icon-chevron-down").addClass('icon-white');
        }else{
            $(this).find(".icon-chevron-up").addClass('icon-white');
            $(this).find(".icon-chevron-down").addClass('icon-white');
        }
    });
    
    $(".dropdown-menu li").click(function(){
        $(".choosed").removeClass("choosed")
        $(this).addClass("choosed")
        $(".dropdown-toggle").html($(".choosed a").html())
        fetch_hotel()
    });
    
    //search result is restricted on hotel_city and hotel_name
    function fetch_hotel(){
        $("#display_hotel_panel").show()
        console.log($("#hotel_city").val());
        $("#hotel_list").html('查询中，请稍候...')
        $.getJSON(
            "/hotel/search/async",// url
            {
                location: $("#hotel_city").val(),//city,
                name: $("#hotel_name").val(),//h_name,
                type: 'search',
            }, // data
            function(data){ // callback
                console.log(data)
                  switch($(".choosed").val()){
                  case 0:
                        break;
                  case 1:
                        data.hotel.sort(function(a,b){
                            return (a[3]-b[3])
                        });
                        break;
                  data.hotel.sort()}
                $("#hotel_list").html('')
                strdata="<td></td><td id='hotel_name'><strong>酒店名称</strong></td><td id='hotel_discription'><strong>酒店位置</strong></td><td><strong>最低报价</strong></td><td></td>"/*"<td id='hotel_rate'><strong>酒店星级</strong></td><td id='hotel_discount'><strong>折扣</strong></td><td id='hotel_price'>"+*/
                $("#hotel_list").append($("<tr>",{html:strdata}))
                for( var i in data.hotel) {
                  fill_list(data.hotel[i],i)
                }
                if(data.hotel.length == 0){
                    $("#hotel_list").html('未查询到满足条件的酒店')
                }
            }
        );
    }
    
    
    function fill_list(hotel,i){//编号 名称 描述 位置
        strdata = "<tr><td id=\"hotel_id\">"+hotel[0]+"</td>" // hotel[0] hotel_id
        strdata = strdata+"<td id=\"hotel_name\">"+ hotel[1] +"</td>"//name
        strdata = strdata+"<td>"+ hotel[2] +"</td>"//description
        strdata = strdata+"<td id=\"price\">最低"+ hotel[3] +"起</td>"//price
        strdata = strdata+"<td><button class=\"btn btn-info\" onclick=\"submit_hotel_book($(this).parent().parent().children('#hotel_id').html(),$('#dtp_in').val(),$('#dtp_leave').val(),$(this).parent().parent().children('#price').html())\">订购 »</button></td></tr>"
        $("#hotel_list").append($("<tbody>",{html:strdata}))
    }
    
    $("#bookquery").hide()
    function submit_hotel_book(hotel_id,start_date,end_date,price){
        strdata = "<input type=\"text\" name=\"order_type\" value=\"hotel\">"
        strdata = strdata + "<input type=\"text\" name=\"hotel_id\" value=\"" + hotel_id + "\">"
        strdata = strdata + "<input type=\"text\" name=\"start_date\" value=\"" + start_date + "\">"
        strdata = strdata + "<input type=\"text\" name=\"end_date\" value=\"" + end_date + "\">"
        strdata = strdata + "<input type=\"text\" name=\"price\" value=\"" + price + "\">"
        $("#bookquery").append(strdata)
        $("#bookquery").submit()
    }
</script>
  </body>
  
</html>
